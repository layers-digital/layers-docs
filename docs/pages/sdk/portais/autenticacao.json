{
  "path": "/docs/sdk/portais/autenticacao",
  "template": "default",
  "title": "Autenticação",
  "tableOfContents": true,
  "previousText": "Propriedades e Métodos",
  "previousUrl": "/docs/sdk/portais/propriedades-e-metodos",
  "body": [
    "div",
    null,
    [
      "p",
      {
        "class": "intro"
      },
      "Há duas maneiras de fazer autenticação de portais na Layers que devem ser implantadas simultaneamente para que o portal funcione corretamente tanto com a versão antiga quanto com a versão nova da Layers. O método antigo de autenticação será desativado assim como o app antigo da Layers em 2021."
    ],
    " ",
    [
      "h2",
      {
        "id": "m-todo-antigo"
      },
      " ",
      [
        "a",
        {
          "href": "#m-todo-antigo"
        },
        "Método Antigo"
      ],
      " "
    ],
    " ",
    [
      "p",
      null,
      "Ao abrir a URL cadastrada como portal na Layers, serão passados os parâmetros ",
      [
        "code",
        null,
        "token"
      ],
      " e ",
      [
        "code",
        null,
        "community"
      ],
      " como no exemplo abaixo. "
    ],
    " ",
    [
      "docs-code",
      {
        "language": "http"
      },
      " ",
      [
        "pre",
        null,
        [
          "code",
          null,
          [
            "span",
            {
              "class": "token method"
            },
            [
              "span",
              {
                "class": "token get"
              },
              "GET"
            ]
          ],
          " ",
          [
            "span",
            {
              "class": "token schema"
            },
            "https://"
          ],
          "meu-app.com",
          [
            "span",
            {
              "class": "token path"
            },
            "/meu-portal"
          ],
          [
            "span",
            {
              "class": "token query"
            },
            [
              "span",
              {
                "class": "token separator"
              },
              "?"
            ],
            [
              "span",
              {
                "class": "token param"
              },
              [
                "span",
                {
                  "class": "token name"
                },
                "token"
              ],
              "=",
              [
                "span",
                {
                  "class": "token value"
                },
                [
                  "span",
                  {
                    "class": "token string"
                  },
                  "{TOKEN_DE_ACCOUNT}"
                ]
              ]
            ],
            [
              "span",
              {
                "class": "token separator"
              },
              "&"
            ],
            [
              "span",
              {
                "class": "token param"
              },
              [
                "span",
                {
                  "class": "token name"
                },
                "community"
              ],
              "=",
              [
                "span",
                {
                  "class": "token value"
                },
                [
                  "span",
                  {
                    "class": "token string"
                  },
                  "{COMMUNITY}"
                ]
              ]
            ]
          ]
        ]
      ],
      " "
    ],
    " ",
    [
      "p",
      null,
      "Para que o portal funcione corretamente com a versão antiga da Layers, é preciso que ele faça autenticação com o ",
      [
        "code",
        null,
        "token"
      ],
      " e ",
      [
        "code",
        null,
        "community"
      ],
      " através da seuinte requisição:"
    ],
    " ",
    [
      "docs-code",
      {
        "language": "http"
      },
      " ",
      [
        "pre",
        null,
        [
          "code",
          null,
          [
            "span",
            {
              "class": "token method"
            },
            [
              "span",
              {
                "class": "token get"
              },
              "GET"
            ]
          ],
          " ",
          [
            "span",
            {
              "class": "token schema"
            },
            "https://"
          ],
          "api.layers.digital",
          [
            "span",
            {
              "class": "token path"
            },
            [
              "span",
              {
                "class": "token version"
              },
              "/v1"
            ],
            "/user/me"
          ]
        ]
      ],
      " "
    ],
    " ",
    [
      "p",
      null,
      "Será necessário passar os seguintes headers:"
    ],
    " ",
    [
      "ul",
      null,
      " ",
      [
        "li",
        null,
        [
          "strong",
          null,
          "authorization"
        ],
        ": Bearer + ",
        [
          "code",
          null,
          "TOKEN_DE_ACCOUNT"
        ]
      ],
      " ",
      [
        "li",
        null,
        [
          "strong",
          null,
          "x-community-id"
        ],
        ": ",
        [
          "code",
          null,
          "COMMUNITY"
        ]
      ],
      " ",
      [
        "li",
        null,
        [
          "strong",
          null,
          "user-agent"
        ],
        ": AppId"
      ],
      " "
    ],
    " ",
    [
      "p",
      null,
      "Se as informações dos headers estiverem corretas, essa requisição retornará um JSON contendo as ",
      [
        "stencil-route-link",
        {
          "url": "/docs/api/data/user/object"
        },
        "informações do usuário"
      ],
      " que está acessando o portal."
    ],
    " ",
    [
      "p",
      null,
      [
        "strong",
        null,
        "IMPORTANTE"
      ],
      ": Utilize o ",
      [
        "code",
        null,
        "TOKEN_DE_ACCOUNT"
      ],
      " dos headers apenas para essa requisição. Para todas as outras requisições para APIs da Layers é necessário usar o token gerado para a sua aplcação quando a permissão de uso de API foi concedida."
    ],
    " ",
    [
      "h2",
      {
        "id": "m-todo-novo"
      },
      " ",
      [
        "a",
        {
          "href": "#m-todo-novo"
        },
        "Método Novo"
      ],
      " "
    ],
    " ",
    [
      "p",
      null,
      "Para a versão nova da Layers a autenticação pode ser feita através do uso das informações no SDK de portais e da ",
      [
        "stencil-route-link",
        {
          "url": "/docs/api/auth/sso/session/validate"
        },
        "rota de validar sessão"
      ],
      ". Essa rota recebe nos parâmetros da query a ",
      [
        "code",
        null,
        "session"
      ],
      ", o ",
      [
        "code",
        null,
        "userId"
      ],
      " e a ",
      [
        "code",
        null,
        "communityId"
      ],
      ". Essas informações podem ser extraídas do SDK de portais da seguinte maneira: "
    ],
    " ",
    [
      "docs-code",
      {
        "language": "js"
      },
      " ",
      [
        "pre",
        null,
        [
          "code",
          null,
          [
            "span",
            {
              "class": "token keyword"
            },
            "const"
          ],
          " session ",
          [
            "span",
            {
              "class": "token operator"
            },
            "="
          ],
          " LayersPortal",
          [
            "span",
            {
              "class": "token punctuation"
            },
            "."
          ],
          "session\n",
          [
            "span",
            {
              "class": "token keyword"
            },
            "const"
          ],
          " communityId ",
          [
            "span",
            {
              "class": "token operator"
            },
            "="
          ],
          " LayersPortal",
          [
            "span",
            {
              "class": "token punctuation"
            },
            "."
          ],
          "communityId\n",
          [
            "span",
            {
              "class": "token keyword"
            },
            "const"
          ],
          " userId ",
          [
            "span",
            {
              "class": "token operator"
            },
            "="
          ],
          " LayersPortal",
          [
            "span",
            {
              "class": "token punctuation"
            },
            "."
          ],
          "userId"
        ]
      ],
      " "
    ],
    " ",
    [
      "p",
      null,
      "Caso as informações enviadas sejam válidas, essa rota responderá com status ",
      [
        "code",
        null,
        "200"
      ],
      " confirmando que essa é uma sessão válida e o usuário está autenticado na Layers."
    ]
  ],
  "headings": [
    {
      "text": "Método Antigo",
      "href": "#m-todo-antigo"
    },
    {
      "text": "Método Novo",
      "href": "#m-todo-novo"
    }
  ],
  "pageClass": "page-sdk-portais-autenticacao"
}
